# Logging System Documentation

## Overview

The Writing Studio Analytics tool maintains comprehensive logs of all AI Chat interactions in `logs/queries.log`. This consolidated log file captures every query, response, and error for debugging and analysis purposes.

## Log File: `queries.log`

### What Gets Logged

Every interaction with the AI Chat Assistant is logged, including:

1. **User Queries** - All questions asked by users
   - Query text (full)
   - Timestamp
   - Acceptance status (ACCEPTED, REJECTED, ERROR)
   - Rejection reason (if applicable)

2. **AI Responses** - All responses generated by the system
   - Full response text
   - Metadata:
     - Whether LLM was called
     - Whether code execution was used
     - Whether PII filtering was applied
   - Error details (if an error occurred)

### Log Format

```
[2026-01-26 21:15:32] QUERY
User: "What were the busiest days?"
Status: ACCEPTED
───────────────────────────────────
[2026-01-26 21:15:35] RESPONSE
LLM Called: Yes
Code Execution: Yes
PII Filtered: No
Response: "The busiest days were Tuesdays and Wednesdays, with an average of..."
═══════════════════════════════════

[2026-01-26 21:16:08] QUERY
User: "How long do hippos live?"
Status: REJECTED
Reason: off_topic: hippo
───────────────────────────────────
[2026-01-26 21:16:08] RESPONSE
LLM Called: No
Code Execution: No
PII Filtered: No
Response: "I'm a data analysis assistant for Writing Studio analytics..."
═══════════════════════════════════

[2026-01-26 21:17:22] QUERY
User: "Show me all sessions"
Status: ACCEPTED
───────────────────────────────────
[2026-01-26 21:17:25] RESPONSE
Error: YES
Error Type: CUDAError
Error Details: CUDA out of memory
Response: "I encountered an error generating a response: CUDA out of memory"
═══════════════════════════════════
```

### Status Values

- **ACCEPTED** - Query passed safety validation and was processed
- **REJECTED** - Query was blocked (off-topic, inappropriate, jailbreak attempt)
- **ERROR** - System error occurred during processing

### Response Metadata

- **LLM Called** - Whether the language model was invoked
- **Code Execution** - Whether dynamic code execution was used for computation
- **PII Filtered** - Whether sensitive information was removed from response
- **Error** - Whether an error occurred during processing

## Use Cases

### 1. Debugging User Issues

When a user reports "it's acting weird", request the `logs/queries.log` file. The log will show:

- What questions were asked
- How they were processed
- Any errors that occurred
- Whether queries were being rejected incorrectly

### 2. Safety Review

Review rejected queries to understand:
- What types of questions users are asking
- Whether the safety filters are working correctly
- If any valid queries are being blocked (false positives)

### 3. Performance Analysis

Analyze response times and code execution usage to:
- Identify slow queries
- Optimize system performance
- Understand user behavior patterns

### 4. Compliance Auditing

Logs provide a complete audit trail of all AI interactions, which can be useful for:
- Demonstrating FERPA compliance
- Investigating privacy concerns
- System transparency

## File Management

### Size Considerations

The log file will remain small under normal usage:
- Estimated usage: A few times per semester
- Estimated queries: 50-100 per semester
- Estimated file size: ~50KB per semester

### No Log Rotation

Currently, log rotation is **NOT implemented** because:
- Usage is infrequent (not daily)
- File size remains small (<100KB typical)
- Simplicity is preferred over automation

If usage increases significantly in the future, log rotation can be added:
- Size-based: Rotate when file exceeds 10MB
- Time-based: Create new log file daily/weekly
- Keep only last N files: Automatically delete old logs

## Privacy Note

The log file may contain:
- User queries (which could contain PII if users accidentally include it)
- System responses (which are filtered for PII)

**Important**: The log file should be treated as sensitive and shared only with authorized personnel for debugging purposes.

## Troubleshooting

### Log Not Being Created

If `logs/queries.log` doesn't exist:
1. Check if the `logs/` directory exists in the project root
2. Ensure the application has write permissions to the logs directory
3. Verify logging is enabled in the code (default: enabled)

### Logs Are Empty

If the log file exists but is empty:
1. Check if the AI Chat has been used yet
2. Verify the log file path in `src/ai_chat/safety_filters.py` and `src/ai_chat/chat_handler.py`
3. Check for error messages in the console

### Cannot Read Log File

If you can't open or read the log file:
1. Ensure the file is not being written to by another process
2. Check file permissions
3. Try opening in a different text editor

## Support

For questions about the logging system:
1. Review this documentation
2. Check the log file itself for patterns
3. Contact the system administrator